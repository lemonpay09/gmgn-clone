# 快速测试指南

## 启动应用

```bash
npm run dev
# 应用在 http://localhost:3000 运行
```

## 测试场景

### 1️⃣ **测试登录和初始化**

1. 访问 http://localhost:3000/trade
2. 页面显示"请先登录账户才能进行交易"
3. 点击"前往登录"按钮
4. 输入任意邮箱和密码（演示中不验证）
   - 邮箱: `test@example.com`
   - 密码: `123456`
5. 点击"登录"
6. 页面刷新后显示交易界面
7. 查看页面头部，右侧显示 "余额: $100,000.00 USDT"

### 2️⃣ **测试市价买入**

1. 确保已登录
2. 交易界面选择 "BTC/USDT"
3. 确认"订单类型"选择为"市价"
4. 点击"买入"选项卡
5. 输入数量，例如：`0.001`（购买 0.001 BTC）
6. 点击"买入 BTC"按钮
7. 看到成功提示，显示购买数量和价格
8. 页面头部余额更新（减少购买花费）
9. 右侧"成交历史"标签页显示该交易

### 3️⃣ **测试市价卖出**

1. 确保有 BTC 持仓（从上一步骤）
2. 点击"卖出"选项卡
3. 输入数量，例如：`0.0005`
4. 点击"卖出 BTC"按钮
5. 看到成功提示
6. 页面头部余额更新（增加卖出收入）
7. 成交历史增加新的卖出记录

### 4️⃣ **测试限价单**

1. 确保已登录且有足够余额
2. 交易界面，点击"限价"开关
3. 点击"买入"选项卡
4. 输入限价价格（示例：45000）
5. 输入数量（示例：0.001）
6. 点击"买入 BTC"
7. 看到"限价 买入 订单已提交"
8. 右侧"当前挂单"显示该订单
9. **等待市场价格下跌到 45000**
10. 当价格触达时，订单自动成交
11. 订单从"当前挂单"移到"成交历史"
12. 余额自动扣除，持仓自动增加

### 5️⃣ **测试余额不足**

1. 登录后，市价买入多笔订单用完 100,000 USDT
2. 再尝试买入
3. 看到错误提示："余额不足。需要 $XXX USDT，当前余额 $YYY USDT"

### 6️⃣ **测试持仓不足**

1. 登录后持有一些 BTC（从买入中获得）
2. 切换到"卖出"
3. 输入超过持有数量的数量
4. 点击"卖出"
5. 看到错误提示："BTC 持仓不足。需要 XXX, 当前持仓 YYY"

### 7️⃣ **测试钱包页面**

1. 点击页面头部导航"钱包"
2. 在"资产总览"部分看到：
   - 总资产估值（所有持仓的美元价值）
   - USDT 余额
   - 所有持仓的币种、数量和美元价值
3. 在"交易记录"部分看到所有成交的订单历史

### 8️⃣ **测试数据持久化**

1. 进行一些交易操作，记住最终的余额
2. **打开浏览器开发者工具** (F12)
3. 进入 "Application" > "Local Storage"
4. 看到存储的数据：
   ```
   user: {"id":"...", "email":"test@example.com", ...}
   account_user-xxx: {"userId":"...", "balance":99000, "holdings":{"BTC":0.001}, ...}
   ```
5. **关闭浏览器标签页**
6. **重新访问** http://localhost:3000/trade
7. 页面自动登录（基于 localStorage 数据）
8. 页头显示相同的余额
9. 访问 /wallet，显示相同的持仓和交易历史
10. **验证数据完全恢复** ✓

### 9️⃣ **测试登出**

1. 登录后，点击页面头部用户头像
2. 点击"登出"
3. 页面刷新，显示"请先登录"提示
4. 打开浏览器开发者工具，查看 Local Storage
5. "user" 和账户数据已被清除

### 🔟 **测试换币种**

1. 在交易界面左侧"市场"选择不同币种（BTC/USDT, ETH/USDT, SOL/USDT）
2. K-线图表更新显示该币种的实时数据
3. 实时价格更新
4. 右侧订单历史自动过滤显示该币种的订单
5. 尝试交易不同币种，验证持仓和交易历史正确分类

## 预期结果总结

| 测试项 | 预期结果 |
|--------|---------|
| 未登录访问交易 | 显示登录提示 ✓ |
| 登录后余额 | 显示 $100,000.00 USDT ✓ |
| 市价买入 | 余额扣除，持仓增加 ✓ |
| 市价卖出 | 余额增加，持仓减少 ✓ |
| 限价单挂起 | 订单显示在"当前挂单" ✓ |
| 限价单成交 | 价格触达自动成交，账户更新 ✓ |
| 余额不足 | 显示错误，交易不执行 ✓ |
| 持仓不足 | 显示错误，交易不执行 ✓ |
| 钱包显示 | 资产和交易历史正确 ✓ |
| 数据持久化 | 刷新后数据保留 ✓ |
| 登出 | 数据清除，需要重新登录 ✓ |
| 币种切换 | 数据正确过滤和显示 ✓ |

## 常见问题排查

### Q: 登录后仍然显示"请先登录"
- 检查 localStorage 是否启用（不是隐私模式）
- 检查浏览器控制台是否有错误

### Q: 余额没有更新
- 确认订单提交时没有错误提示
- 检查金额计算是否正确
- 查看 localStorage 中的 account 数据是否更新

### Q: 限价单不自动成交
- 确认市场价格确实低于/高于挂单价格
- 检查浏览器控制台的 WebSocket 连接状态
- 可能需要等待几秒钟让价格数据更新

### Q: 页面刷新后数据丢失
- 检查浏览器是否启用了 localStorage
- 查看浏览器设置中的隐私设置
- 清除浏览器缓存可能会影响数据

## 开发者工具检查

### 检查 localStorage
```javascript
// 在浏览器控制台运行
console.log(localStorage.getItem('user'));
console.log(localStorage.getItem('account_' + JSON.parse(localStorage.getItem('user')).id));
```

### 检查网络请求
- F12 > Network 标签
- 登录时应该看到 POST /api/auth/login
- 查看响应中的用户数据

### 检查 React 状态
- React DevTools 扩展
- 查看 AuthContext 中的 account 和 user 状态
- 订单提交后查看 OrderContext 中的 orders 状态

## 性能测试

- 进行 10 笔市价单交易，验证页面流畅性
- 挂起 5 个限价单，验证内存使用
- 每隔 1 秒切换一次币种，验证 WebSocket 连接正确释放
